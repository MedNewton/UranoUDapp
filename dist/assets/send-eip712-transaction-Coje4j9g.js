const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B7UgA71q.js","assets/index-CuOng2Rd.css"])))=>i.map(i=>d[i]);
import{al as b,aP as h,aQ as v,u as L,aR as m,ah as G,h as D,aS as z,K as P,_ as B,J as S,aT as M}from"./index-B7UgA71q.js";import{e as O}from"./eth_sendRawTransaction-DPdnXbFR.js";import{concatHex as A}from"./concat-hex-DlW8-qy4.js";import{m as $,s as R,t as H}from"./sha256-CuE4SomN.js";const _=$*32n;class V extends b{constructor({givenLength:e,maxBytecodeSize:a}){super(`Bytecode cannot be longer than ${a} bytes. Given length: ${e}`,{name:"BytecodeLengthExceedsMaxSizeError"})}}class W extends b{constructor({givenLengthInWords:e}){super(`Bytecode length in 32-byte words must be odd. Given length in words: ${e}`,{name:"BytecodeLengthInWordsMustBeOddError"})}}class k extends b{constructor({givenLength:e}){super(`The bytecode length in bytes must be divisible by 32. Given length: ${e}`,{name:"BytecodeLengthMustBeDivisibleBy32Error"})}}function U(t){const e=h(t);if(e.length%32!==0)throw new k({givenLength:e.length});if(e.length>_)throw new V({givenLength:e.length,maxBytecodeSize:_});const a=R(e),n=h(a),r=e.length/32;if(r%2===0)throw new W({givenLengthInWords:r});const i=h(r),s=v(i,{size:2}),o=new Uint8Array([1,0]);return n.set(o,0),n.set(s,2),n}function f(t){if(["string","number"].includes(typeof t)&&!Number.isInteger(Number(t)))throw new Error(`Expected value to be an integer to convert to a bigint, got ${t} of type ${typeof t}`);return t instanceof Uint8Array?BigInt(L(t)):BigInt(t)}const x=(t,e)=>typeof t=="bigint"?e(t):Array.isArray(t)?t.map(a=>x(a,e)):t&&typeof t=="object"?Object.fromEntries(Object.entries(t).map(([a,n])=>[a,x(n,e)])):t,T=50000n,N=t=>{const e=C(t);return{domain:{chainId:t.chainId,name:"zkSync",version:"2"},message:e,primaryType:"Transaction",types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]}}};function C(t){const{gas:e,nonce:a,to:n,from:r,value:i,maxFeePerGas:s,maxPriorityFeePerGas:o,paymaster:d,paymasterInput:u,gasPerPubdata:y,data:g,factoryDeps:p}=t;return{data:g||"0x0",factoryDeps:(p==null?void 0:p.map(c=>m(U(c))))??[],from:BigInt(r),gasLimit:e??0n,gasPerPubdataByteLimit:y??T,maxFeePerGas:s??0n,maxPriorityFeePerGas:o??0n,nonce:a?BigInt(a):0n,paymaster:d?BigInt(d):0n,paymasterInput:u||"0x",to:n?BigInt(n):0n,txType:113n,value:i??0n}}async function J(t){const{account:e,transaction:a}=t,n=await w(t),r=await I({account:e,chainId:a.chain.id,eip712Transaction:n}),i=G(a),s=await O(i,r);return{chain:a.chain,client:a.client,transactionHash:s}}async function I(t){const{account:e,eip712Transaction:a,chainId:n}=t,r=N(a),i=await e.signTypedData({...r});return K({...a,chainId:n,customSignature:i})}async function w(t){const{account:e,transaction:a}=t,{gas:n,maxFeePerGas:r,maxPriorityFeePerGas:i,gasPerPubdata:s}=await F({from:D(e.address),transaction:a});return{...await z({from:e.address,transaction:{...a,gas:n,maxFeePerGas:r,maxPriorityFeePerGas:i}}),...a.eip712,from:e.address,gasPerPubdata:s}}function K(t){const{chainId:e,gas:a,nonce:n,to:r,from:i,value:s,maxFeePerGas:o,maxPriorityFeePerGas:d,customSignature:u,factoryDeps:y,paymaster:g,paymasterInput:p,gasPerPubdata:c,data:l}=t,E=[n?m(n):"0x",d?m(d):"0x",o?m(o):"0x",a?m(a):"0x",r??"0x",s?m(s):"0x",l??"0x0",m(e),m(""),m(""),m(e),i??"0x",c?m(c):m(T),y??[],u??"0x",g&&p?[g,p]:[]];return A(["0x71",H(E)])}async function F(t){const{transaction:e,from:a}=t;let[n,r,i,s]=await Promise.all([P(e.gas),P(e.maxFeePerGas),P(e.maxPriorityFeePerGas),P(e.eip712)]),o=s==null?void 0:s.gasPerPubdata;if(n===void 0||r===void 0||i===void 0){const d=G(e),u=await Q({from:a,transaction:e});try{const y=await d({method:"zks_estimateFee",params:[x(u,m)]});n=f(y.gas_limit)*2n,r=f(y.max_fee_per_gas)*2n,i=f(y.max_priority_fee_per_gas)||1n,o=f(y.gas_per_pubdata_limit)*2n,o<50000n&&(o=50000n)}catch{const[{estimateGas:y},{getDefaultGasOverrides:g}]=await Promise.all([B(()=>import("./index-B7UgA71q.js").then(l=>l.eM),__vite__mapDeps([0,1])),B(()=>import("./index-B7UgA71q.js").then(l=>l.eL),__vite__mapDeps([0,1]))]),[p,c]=await Promise.all([n===void 0?y({transaction:e,from:a}):Promise.resolve(n),g(e.client,e.chain)]);n=p*2n,"maxFeePerGas"in c&&c.maxFeePerGas?r=c.maxFeePerGas*2n:"gasPrice"in c&&c.gasPrice&&(r=c.gasPrice*2n),"maxPriorityFeePerGas"in c&&c.maxPriorityFeePerGas?i=c.maxPriorityFeePerGas:i=1n,o=100000n}}return{gas:n,gasPerPubdata:o,maxFeePerGas:r,maxPriorityFeePerGas:i}}async function Q(t){var d;const{transaction:e,from:a}=t,[n,r,i,s]=await Promise.all([S(e),P(e.to),P(e.value),P(e.eip712)]),o=s==null?void 0:s.gasPerPubdata;return{data:n,eip712Meta:{...s,factoryDeps:(d=s==null?void 0:s.factoryDeps)==null?void 0:d.map(u=>Array.from(M(u))),gasPerPubdata:o||50000n},from:a,gasPerPubdata:o,to:r,type:"0x71",value:i}}const j=Object.freeze(Object.defineProperty({__proto__:null,getZkGasFees:F,populateEip712Transaction:w,sendEip712Transaction:J,signEip712Transaction:I},Symbol.toStringTag,{value:"Module"}));export{j as a,w as p,I as s,f as t};
